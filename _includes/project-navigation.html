{% if page.collection %}

    {% assign collection = site[page.collection] %}

    {% assign current_item = nil %}

    {% for item in collection %}
        {% if item.url == page.url %}
            {% assign current_item = item %}
        {% endif %}
    {% endfor %}

    {% if current_item %}

        {% assign parents = collection
            | where_exp: "item", "item.parent == nil"
            | sort: "date"
            | reverse %}

        {% assign siblings = "" | split: "" %}

        {% for parent in parents %}

            {% assign children = collection
                | where: "parent", parent.slug
                | sort: "date" %}

            {% if children.size > 0 %}
                {% for child in children %}
                    {% assign siblings = siblings | push: child %}
                {% endfor %}
            {% else %}
                {% assign siblings = siblings | push: parent %}
            {% endif %}

        {% endfor %}

        {% assign current_index = nil %}

        {% for item in siblings %}
            {% if item.url == page.url %}
                {% assign current_index = forloop.index0 %}
            {% endif %}
        {% endfor %}

        {% if current_index != nil %}

        <div class="project-navigation">

            {% if current_index > 0 %}
                {% assign prev_index = current_index | minus: 1 %}
                {% assign prev_item = siblings[prev_index] %}
                <a href="{{ prev_item.url }}" class="nav-prev">
                    <img src="/assets/prev.png" alt="Previous project">
                     <span>Previous Project</span>
                </a>
            {% endif %}

            {% if current_index < siblings.size | minus: 1 %}
                {% assign next_index = current_index | plus: 1 %}
                {% assign next_item = siblings[next_index] %}
                <a href="{{ next_item.url }}" class="nav-next">
                    <span>Next Project</span>
                    <img src="/assets/next.png" alt="Next project">
                </a>
            {% endif %}

        </div>

        {% endif %}
    {% endif %}
{% endif %}