{% if page.collection %}

{% assign collection = site[page.collection] %}

{% assign parents = collection
   | where_exp: "item", "item.parent == blank"
   | sort: "date"
   | reverse %}

{% assign previous_item = nil %}
{% assign next_item = nil %}
{% assign found = false %}

{% for parent in parents %}

    {% assign children = collection
        | where: "parent", parent.slug
        | sort: "date" %}

    {% if children.size > 0 %}
        {% for child in children %}

            {% if found and next_item == nil %}
                {% assign next_item = child %}
            {% endif %}

            {% if child.url == page.url %}
                {% assign found = true %}
            {% endif %}

            {% unless found %}
                {% assign previous_item = child %}
            {% endunless %}

        {% endfor %}
    {% else %}

        {% if found and next_item == nil %}
            {% assign next_item = parent %}
        {% endif %}

        {% if parent.url == page.url %}
            {% assign found = true %}
        {% endif %}

        {% unless found %}
            {% assign previous_item = parent %}
        {% endunless %}

    {% endif %}

{% endfor %}

{% if previous_item or next_item %}

<div class="project-navigation">

    {% if previous_item %}
        <a href="{{ previous_item.url }}" class="nav-prev">
            <img src="/assets/prev.png" alt="Previous project">
            <span>Previous Project</span>
        </a>
    {% endif %}

    {% if next_item %}
        <a href="{{ next_item.url }}" class="nav-next">
            <span>Next Project</span>
            <img src="/assets/next.png" alt="Next project">
        </a>
    {% endif %}

</div>

{% endif %}
{% endif %}