<aside class="sidebar">
    <div class="sidebar-list">

        {% if page.collection == "projects" or page.url contains "/projects" %}
            {% assign items = site.projects %}
        {% elsif page.collection == "drawings" or page.url contains "/drawings" %}
            {% assign items = site.drawings %}
        {% elsif page.collection == "archive" or page.url contains "/archive" %}
            {% assign items = site.archive %}
        {% elsif page.collection == "about" or page.url contains "/about" %}
            {% assign items = site.about %}
        {% else %}
            {% assign items = nil %}
        {% endif %}

        {% if items %}

            {% assign parents = items
                | where_exp: "item", "item.parent == nil"
                | sort: "date"
                | reverse %}

            {% for item in parents %}

                {% assign children = items
                    | where: "parent", item.slug
                    | sort: "date" %}

                {% assign is_open = false %}

                {% if page.parent == item.slug %}
                    {% assign is_open = true %}
                {% endif %}

                {% for child in children %}
                    {% if page.url == child.url %}
                        {% assign is_open = true %}
                    {% endif %}
                {% endfor %}

                <div class="sidebar-group {% if is_open %}open{% endif %}">

                    {%- comment -%}
                    Wenn Subprojekte existieren â†’ Parent-Link zeigt auf erstes Subprojekt
                    {%- endcomment -%}

                    {% if children.size > 0 %}
                        {% assign first_child = children.first %}
                        <a href="{{ first_child.url }}"
                            data-project="{{ item.slug }}"
                           class="{% if page.url contains item.url %}active{% endif %}">
                            {{ item.title }}
                        </a>
                    {% else %}
                        <a href="{{ item.url }}"
                            data-project="{{ item.slug }}"
                           class="{% if page.url == item.url %}active{% endif %}">
                            {{ item.title }}
                        </a>
                    {% endif %}

                    {% if children.size > 0 %}
                        <div class="sidebar-sub">
                            {% for child in children %}
                                <a href="{{ child.url }}"
                                    data-project="{{ child.slug }}"
                                   class="{% if page.url == child.url %}active{% endif %}">
                                    {{ child.title }}
                                </a>
                            {% endfor %}
                        </div>
                    {% endif %}

                </div>

            {% endfor %}

        {% endif %}

    </div>
</aside>